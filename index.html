<!DOCTYPE html>
<html>
<head>
</head>
<style>
td {background-color: #grey; text-align: center; width: 20%; height:0px; padding-bottom: 20%;}
td.field {background-color: #F8C471; position: relative; }
td.centerfield {background-color: #grey; text-align: left; padding-bottom: 0%}
section.fieldsection {position:absolute; }
.buttonsection {position: absolute; width:100%; touch-action: manipulation; }
.dicebutton {text-align: center; font-size: 10em;}
.fartbutton {text-align: center; font-size: 10em;}
.diceresultdiv {font-size: 3em; font-family: sans-serif; height:20%; color: white; text-align: center; vertical-align: middle;}
.camelPiece {
	border-left: 30px solid transparent;
	border-right: 30px solid transparent;
	height: 0;
	width: 100%;
}
#camelPiece0 {  border-bottom: 30px solid #900B00;}
#camelPiece1 { border-bottom: 30px solid #009001;}
#camelPiece2 {  border-bottom: 30px solid #000F96;}
#camelPiece3 { border-bottom: 30px solid #960089;}
#camelPiece4 { border-bottom: 30px solid #444444;}


#roundLabel {font-size: 2em; font-family: sans-serif;}
#c0 {background-color: #900B00;}
#c1 {background-color: #009001; }
#c2 {background-color: #000F96;}
#c3 {background-color: #960089; }
#c4 {background-color: #444444; }
</style>
<body style="background-color: grey" >
<h1 id="roundLabel">Round: 1</h1>
<p>
  <table width="100%">
    <tr>
      <td class="field"><section id="f0" class="fieldsection"></section></td>
      <td class="field"><section id="f1" class="fieldsection"></section></td>
      <td class="field"><section id="f2" class="fieldsection"></section></td>
      <td class="field"><section id="f3" class="fieldsection"></section></td>
      <td class="field"><section id="f4" class="fieldsection"></section></td>
    </tr>
    <tr>
      <td class="field"><section id="f15" class="fieldsection"></section></td>
      <td id="IdCenterField" class="centerfield" colspan="3" rowspan="3">
          <div class="diceresultdiv" id="c0"></div>
          <div class="diceresultdiv" id="c1"></div>
          <div class="diceresultdiv" id="c2"></div>
          <div class="diceresultdiv" id="c3"></div>
          <div class="diceresultdiv" id="c4"></div>
      </td>
      <td class="field"><section id="f5" class="fieldsection"></section></td>
    </tr>
    <tr>
      <td class="field"><section id="f14" class="fieldsection"></section></td>
      <td class="field"><section id="f6" class="fieldsection"></section></td>
    </tr>
    <tr>
      <td class="field"><section id="f13" class="fieldsection"></section></td>
      <td class="field"><section id="f7" class="fieldsection"></section></td>
    </tr>
    <tr>
      <td class="field"><section id="f12" class="fieldsection"></section></td>
      <td class="field"><section id="f11" class="fieldsection"></section></td>
      <td class="field"><section id="f10" class="fieldsection"></section></td>
      <td class="field"><section id="f9" class="fieldsection"></section></td>
      <td class="field"><section id="f8" class="fieldsection"></section></td>
    </tr>
  </table>
</p>
<section class="buttonsection">
<button id="IdDiceButton" class="dicebutton" onclick="diceButtonClicked()">Dice</button>
<button class="fartbutton" onclick="fartClicked()" >Fart</button>
</section>

<script>
var camelsField = new Array (0,0,0,0,0);
var roundNumber = 1;
var fartAudio = new Audio('https://basti421.github.io/fart-01.mp3');

var fields = [ // 16 fields
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1],
	[-1, -1, -1, -1, -1]
];

function StackCamelOnTopOfField(camelId, field)
{
  debugger;
	for (x=0; x < fields[field].length; x++ )
	{
		if (fields[field][x] == -1)
		{
			fields[field][x] = camelId;
			break;
		}
	}
}

function MoveCamel(camelId, resDice)
{
	// Stack on top
	if (roundNumber == 1)
	{
		StackCamelOnTopOfField(camelId,resDice-1);
	}
	else
	{
		// Find camel
		var camelIsInField = -1;
		var camelIsInStackPos = -1;
		debugger;
		for (f = 0; f < fields.length; f++)
		{
			for (i=0; i < fields[f].length; i++)
			{
				console.log(fields[f][i]);
				if (fields[f][i] == camelId)
				{
					camelIsInField = f;
					camelIsInStackPos = i;
					break;
				}
			}
			if (camelIsInField != -1)
			break;
		}
		debugger;
		// move camel and all above it to new field
	  // delete from old field

		var newField = camelIsInField+resDice;
		if (newField >= fields.length)
		{
			newField -= fields.length;
		}
		for (i = camelIsInStackPos; i < fields[camelIsInField].length; i++)
		{
			var curCamelId = fields[camelIsInField][i];
			if (curCamelId == -1)
				break;
			StackCamelOnTopOfField(curCamelId,newField);
			fields[camelIsInField][i] = -1;
			debugger;
		}
	}
}

function fartClicked()
{
	fartAudio.play();
}

function getRndInteger(min, max) {
  return Math.floor(Math.random() * (max - min + 1) ) + min;
}

function refreshCamelResults()
{

document.getElementById("roundLabel").innerHTML = "Round: " + roundNumber;

  if (camelsField[0] == 0) {
        document.getElementById("c0").innerHTML = "";
  }
  else {
        document.getElementById("c0").innerHTML = camelsField[0];
  }

  if (camelsField[1] == 0) {
        document.getElementById("c1").innerHTML = "";
  }
  else {
        document.getElementById("c1").innerHTML = camelsField[1];
  }

  if (camelsField[2] == 0) {
        document.getElementById("c2").innerHTML = "";
  }
  else {
        document.getElementById("c2").innerHTML = camelsField[2];
  }

  if (camelsField[3] == 0) {
        document.getElementById("c3").innerHTML = "";
  }
  else {
        document.getElementById("c3").innerHTML = camelsField[3];
  }
  if (camelsField[4] == 0) {
        document.getElementById("c4").innerHTML = "";
  }
  else {
        document.getElementById("c4").innerHTML = camelsField[4];
  }
}

function refreshFields()
{
	// clear
	for (var f = 0; f < fields.length; f++)
	{
		var fieldIdString = "f" + f;
		document.getElementById(fieldIdString).innerHTML = '';
	}

// fill
	for (var f = 0; f < fields.length; f++)
	{
		for (var i=fields[f].length-1; i >= 0 ; i--)
		{
			if (fields[f][i] != -1)
			{
				var fieldIdString = "f" + f;
				document.getElementById(fieldIdString).innerHTML =
				document.getElementById(fieldIdString).innerHTML +
				'<div class="camelPiece" id="camelPiece' + fields[f][i] + '"></div>'
				;
			}
		}
	}



}


function diceButtonClicked()
{
  // Get number of available camels
  availableCamels = new Array();
  for(var i=0; i<camelsField.length;++i)
  {
    if (camelsField[i] == 0)
    {
        availableCamels.push(i);
    }
  }

  var res = getRndInteger(0,availableCamels.length-1);
  var camelId = availableCamels[res];
  var resDice = getRndInteger(1,3);

	MoveCamel(camelId, resDice);
	refreshFields();


  camelsField[camelId] = resDice;
  refreshCamelResults(); // refresshes only dice result lables


  if (availableCamels.length == 1)
  {
    // this was last camel to move!

    // clear all results
    for(var i=0; i<camelsField.length;++i)
    {
      camelsField[i] = 0;
    }
    roundNumber++;
  }
}
</script>



</body>
</html>
